!function(){var t=function(t,i,h,s,n,e){this.initialize(t,i,h,s,n,e)},i=t.prototype,h=Math.PI,s=2*h;t.identity=null,t.DEG_TO_RAD=Math.PI/180,i.a=1,i.b=0,i.c=0,i.d=1,i.tx=0,i.ty=0,i.initialize=function(t,i,h,s,n,e){return this.a=null==t?1:t,this.b=i||0,this.c=h||0,this.d=null==s?1:s,this.tx=n||0,this.ty=e||0,this},i.prepend=function(t,i,h,s,n,e){var r=this.tx;if(1!=t||0!=i||0!=h||1!=s){var o=this.a,c=this.c;this.a=o*t+this.b*h,this.b=o*i+this.b*s,this.c=c*t+this.d*h,this.d=c*i+this.d*s}return this.tx=r*t+this.ty*h+n,this.ty=r*i+this.ty*s+e,this},i.append=function(t,i,h,s,n,e){var r=this.a,o=this.b,c=this.c,y=this.d;return this.a=t*r+i*c,this.b=t*o+i*y,this.c=h*r+s*c,this.d=h*o+s*y,this.tx=n*r+e*c+this.tx,this.ty=n*o+e*y+this.ty,this},i.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty),this},i.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty),this},i.prependTransform=function(t,i,h,n,e,r,o,c,y){if(e%s)var a=Math.cos(e),u=Math.sin(e);else a=1,u=0;return(c||y)&&(this.tx-=c,this.ty-=y),r||o?(this.prepend(a*h,u*h,-u*n,a*n,0,0),this.prepend(Math.cos(o),Math.sin(o),-Math.sin(r),Math.cos(r),t,i)):this.prepend(a*h,u*h,-u*n,a*n,t,i),this},i.appendTransform=function(t,i,h,n,e,r,o,c,y){if(e%s)var a=Math.cos(e),u=Math.sin(e);else a=1,u=0;return r||o?(this.append(Math.cos(o),Math.sin(o),-Math.sin(r),Math.cos(r),t,i),this.append(a*h,u*h,-u*n,a*n,0,0)):this.append(a*h,u*h,-u*n,a*n,t,i),(c||y)&&(this.tx-=c*this.a+y*this.c,this.ty-=c*this.b+y*this.d),this},i.rotate=function(t){var i=Math.cos(t),h=Math.sin(t),s=this.a,n=this.c,e=this.tx;return this.a=s*i-this.b*h,this.b=s*h+this.b*i,this.c=n*i-this.d*h,this.d=n*h+this.d*i,this.tx=e*i-this.ty*h,this.ty=e*h+this.ty*i,this},i.skew=function(t,i){return this.append(Math.cos(i),Math.sin(i),-Math.sin(t),Math.cos(t),0,0),this},i.scale=function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this},i.translate=function(t,i){return this.tx+=t,this.ty+=i,this},i.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},i.invert=function(){var t=this.a,i=this.b,h=this.c,s=this.d,n=this.tx,e=t*s-i*h;return this.a=s/e,this.b=-i/e,this.c=-h/e,this.d=t/e,this.tx=(h*this.ty-s*n)/e,this.ty=-(t*this.ty-i*n)/e,this},i.isIdentity=function(){return 0==this.tx&&0==this.ty&&1==this.a&&0==this.b&&0==this.c&&1==this.d},i.transformPoint=function(t,i,h){return h=h||{},h.x=t*this.a+i*this.c+this.tx,h.y=t*this.b+i*this.d+this.ty,h},i.decompose=function(t){null==t&&(t={}),t.x=this.tx,t.y=this.ty,t.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),t.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d),s=Math.atan2(this.b,this.a);return i==s?(t.rotation=s,this.a<0&&this.d>=0&&(t.rotation+=t.rotation<=0?h:-h),t.skewX=t.skewY=0):(t.skewX=i,t.skewY=s),t},i.copy=function(t){return this.initialize(t.a,t.b,t.c,t.d,t.tx,t.ty,t.alpha,t.shadow,t.compositeOperation)},i.clone=function(){return(new t).copy(this)},i.toString=function(){return"[Matrix2 (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.identity=new t,window.Matrix2=t}();var Point=function(){this.x=0,this.y=0};Point.prototype.copy=function(t){t.x=this.x,t.y=this.y},Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"};var Rectangle=function(){this.x=0,this.y=0,this.width=0,this.height=0};Rectangle.prototype.copy=function(t){t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height},Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)},Rectangle.prototype.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"};var Vec2=function(t,i){"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),this.x=t,this.y=i};Vec2.prototype.setLength=function(t){var i=this.getLength();return 0!==i&&t!==i&&this.multiplyScalar(t/i),this},Vec2.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vec2.prototype.getLengthSq=function(){return this.x*this.x+this.y*this.y},Vec2.prototype.setAngle=function(t){var i=this.getAngle();return this.x=Math.cos(t)*i,this.y=Math.sin(t)*i,this},Vec2.prototype.getAngle=function(){return Math.atan2(this.y,this.x)},Vec2.prototype.rotateBy=function(t){var i=this.x,h=this.y,s=Math.cos(t),n=Math.sin(t);return this.x=i*s-h*n,this.y=i*n+h*s,this},Vec2.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Vec2.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},Vec2.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},Vec2.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},Vec2.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},Vec2.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},Vec2.prototype.divide=function(t){return 0===t.x||0===t.y?this:(this.x/=t.x,this.y/=t.y,this)},Vec2.prototype.divideScalar=function(t){return 0===t?this:(this.x/=t,this.y/=t,this)},Vec2.prototype.perp=function(){return this.y=-this.y,this},Vec2.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},Vec2.prototype.clamp=function(t,i){return this.x<t.x?this.x=t.x:this.x>i.x&&(this.x=i.x),this.y<t.y?this.y=t.y:this.y>i.y&&(this.y=i.y),this},Vec2.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},Vec2.prototype.crossProd=function(t){return this.x*t.y-this.y*t.x},Vec2.prototype.truncate=function(t){var i=this.getLength();return 0===i||t>i?this:(this.x/=i,this.y/=i,this.multiplyScalar(t),this)},Vec2.prototype.angleTo=function(t){var i=this.x-t.x,h=this.y-t.y;return Math.atan2(h,i)},Vec2.prototype.distanceTo=function(t){var i=this.x-t.x,h=this.y-t.y;return Math.sqrt(i*i+h*h)},Vec2.prototype.distanceToSquared=function(t){var i=this.x-t.x,h=this.y-t.y;return i*i+h*h},Vec2.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},Vec2.prototype.slerp=function(t,i){var h=this.dotProduct(t),s=this.x-t.x,n=this.y-t.y;-1>h&&(h=-1),h>1&&(h=1);var e=Math.acos(h)*i;s*=h,n*=h;var r=Math.sqrt(s*s+n*n);0!==r&&(s/=r,n/=r),this.multiplyScalar(Math.cos(e));var o=Math.sin(e);return this.x+=s*o,this.y+=n*o,this},Vec2.prototype.nlerp=function(t,i){this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i;var h=this.getLength();return 0===h?this:(this.x/=h,this.y/=h,this)},Vec2.prototype.normalize=function(){var t=this.getLength();return 0===t?this:(this.x/=t,this.y/=t,this)},Vec2.prototype.reset=function(t,i){return t=t?t:0,i=i?i:0,this.x=t,this.y=i,this},Vec2.prototype.equals=function(t){return this.x===t.x&&this.y===t.y?!0:!1},Vec2.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},Vec2.prototype.clone=function(){return new Vec2(this.x,this.y)},Vec2.prototype.draw=function(t,i,h,s){i=i?i:0,h=h?h:0,s=s?s:"rgb(0, 250, 0)",t.strokeStyle=s,t.beginPath(),t.moveTo(i,h),t.lineTo(this.x,this.y),t.stroke()},Vec2.prototype.toString=function(){return"["+this.x+", "+this.y+"]"},Vec2.draw=function(t,i,h,s,n,e){n=n||0,e=e||0,t.strokeStyle=s?s:"rgb(250, 10, 10)",t.beginPath(),t.moveTo(i.x+n,i.y+e),t.lineTo(h.x+n,h.y+e),t.stroke()};
!function(){define("../lib/LinkedList.js",[],function(){var t=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0};window.LinkedListNode=t;var e=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueId=Date.now()+""+Math.floor(1e3*Math.random()),this.getNode=function(t){return this.objToNodeMap[t.uniqueId]},this.addNode=function(e){var i=new t;return i.obj=e,i.prev=null,i.next=null,i.free=!1,this.objToNodeMap[e.uniqueId]=i,i},this.add=function(t){var e=this.objToNodeMap[t.uniqueId];if(e){if(e.free===!1)return;e.obj=t,e.free=!1,e.next=null,e.prev=null}else e=this.addNode(t);if(this.first){if(null==this.last)throw new Error("Hmm, no last in the list -- that shouldn't happen here");this.last.next=e,e.prev=this.last,this.last=e,e.next=null}else this.first=e,this.last=e,e.next=null,e.prev=null;this.length++,this.showDebug&&this.dump("after add")},this.has=function(t){return!!this.objToNodeMap[t.uniqueId]},this.moveUp=function(t){this.dump("before move up");var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.prev){var i=e.prev,n=i.prev;e==this.last&&(this.last=i);var s=e.next;n&&(n.next=e),e.next=i,e.prev=i.prev,i.next=s,i.prev=e,this.first==i&&(this.first=e)}},this.moveDown=function(t){var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.next){var i=e.next;this.moveUp(i.obj),this.last==i&&(this.last=e)}},this.sort=function(t){for(var e,i,n=[],s=this.first;s;)n.push(s.object()),s=s.next();for(this.clear(),n.sort(t),i=n.length,e=0;i>e;e++)this.add(n[e])},this.remove=function(t){var e=this.getNode(t);return null==e||1==e.free?!1:(null!=e.prev&&(e.prev.next=e.next),null!=e.next&&(e.next.prev=e.prev),null==e.prev&&(this.first=e.next),null==e.next&&(this.last=e.prev),e.free=!0,e.prev=null,e.next=null,this.length--,!0)},this.shift=function(){var t=this.first;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.first=t.next,t.next||(this.last=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.pop=function(){var t=this.last;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.last=t.prev,t.prev||(this.first=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.clear=function(){for(var t=this.first;t;)t.free=!0,t=t.next;this.first=null,this.length=0},this.dispose=function(){for(var t=this.first;t;)t.obj=null,t=t.next;this.first=null,this.objToNodeMap=null},this.dump=function(t){console.log("===================="+t+"=====================");for(var e=this.first;null!=e;)console.log("{"+e.obj.toString()+"} previous="+(e.prev?e.prev.obj:"NULL")),e=e.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}};return window.LinkedList=e,e}),define("Container",["require"],function(){var t=function(){this.uniqueId=Math.random().toString(36).slice(2)+Date.now(),this.children=new LinkedList,this.visible=!0,this.position=new Vec2,this.angle=0,this.alpha=1,this.parent=null,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.regX=0,this.regY=0,this.compositeOperation=null,this.sourceRect=null,this._matrix=new Matrix2,this._scratchPoint=new Point};return t.prototype={draw:function(t){var e,i,n,s=(this.sourceRect,this);for(n=s._matrix.identity(),n.appendTransform(s.position.x,s.position.y,s.scaleX,s.scaleY,s.angle,s.skewX,s.skewY,s.regX,s.regY),t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),t.globalAlpha*=s.alpha,s.compositeOperation&&(t.globalCompositeOperation=s.compositeOperation),e=this.children.first;e;)i=e.obj,i.visible&&(t.save(),i.draw(t),t.restore()),e=e.next},addChild:function(t){var e,i=arguments.length;if(i>1){for(e=0;i>e;e++)this.addChild(arguments[e]);return arguments[i-1]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.add(t),t},removeChild:function(t){return this.children.remove(t)},removeAllChildren:function(){this.children.clear()},sortChildren:function(t){this.children.sort(t)},contains:function(t){for(;t;){if(t===this)return!0;t=t.parent}return!1},toString:function(){return"[Container (name="+this.name+")]"},getStage:function(){for(var t=this;t.parent;)t=t.parent;return t},localToGlobal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},globalToLocal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.invert(),i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},localToLocal:function(t,e,i){var n=this.localToGlobal(t,e);return i.globalToLocal(n.x,n.y)},setTransform:function(t,e,i,n,s,r,o,l,a){return this.position.x=t||0,this.position.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==n?1:n,this.angle=s||0,this.skewX=r||0,this.skewY=o||0,this.regX=l||0,this.regY=a||0,this},getMatrix:function(t){var e=this;return(t?t.identity():new Matrix2).appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY)},getConcatenatedMatrix:function(t){t?t.identity():t=new Matrix2;for(var e=this;null!=e;)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY),e=e.parent;return t}},t}),define("Sprite",["require"],function(){var t=function(t){this.uniqueId=Math.random().toString(36).slice(2)+Date.now(),this.image=t,this.visible=!0,this.position=new Vec2,this.angle=0,this.alpha=1,this.parent=null,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.regX=0,this.regY=0,this.compositeOperation=null,this.sourceRect=null,this._matrix=new Matrix2,this._scratchPoint=new Point};return t.prototype={isVisible:function(){return this.visible&&this.alpha>0&&this.scaleX&&this.scaleY},draw:function(t){var e,i=this.sourceRect,n=this;e=n._matrix.identity(),e.appendTransform(n.position.x,n.position.y,n.scaleX,n.scaleY,n.angle,n.skewX,n.skewY,n.regX,n.regY),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha*=n.alpha,n.compositeOperation&&(t.globalCompositeOperation=n.compositeOperation),i?t.drawImage(this.image,i.x,i.y,i.width,i.height,0,0,i.width,i.height):t.drawImage(this.image,0,0)},getStage:function(){for(var t=this;t.parent;)t=t.parent;return t},localToGlobal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},globalToLocal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.invert(),i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},localToLocal:function(t,e,i){var n=this.localToGlobal(t,e);return i.globalToLocal(n.x,n.y)},setTransform:function(t,e,i,n,s,r,o,l,a){return this.position.x=t||0,this.position.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==n?1:n,this.angle=s||0,this.skewX=r||0,this.skewY=o||0,this.regX=l||0,this.regY=a||0,this},getMatrix:function(t){var e=this;return(t?t.identity():new Matrix2).appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY)},getConcatenatedMatrix:function(t){t?t.identity():t=new Matrix2;for(var e=this;null!=e;)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY),e=e.parent;return t},toString:function(){return"[Sprite (name="+this.name+")]"}},t})}();