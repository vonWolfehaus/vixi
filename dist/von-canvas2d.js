!function(){define("../lib/LinkedList.js",[],function(){var t=function(){this.obj=null,this.next=null,this.prev=null,this.free=!0};window.LinkedListNode=t;var e=function(){this.first=null,this.last=null,this.length=0,this.objToNodeMap={},this.uniqueId=Date.now()+""+Math.floor(1e3*Math.random()),this.getNode=function(t){return this.objToNodeMap[t.uniqueId]},this.addNode=function(e){var i=new t;return i.obj=e,i.prev=null,i.next=null,i.free=!1,this.objToNodeMap[e.uniqueId]=i,i},this.add=function(t){var e=this.objToNodeMap[t.uniqueId];if(e){if(e.free===!1)return;e.obj=t,e.free=!1,e.next=null,e.prev=null}else e=this.addNode(t);if(this.first){if(null==this.last)throw new Error("Hmm, no last in the list -- that shouldn't happen here");this.last.next=e,e.prev=this.last,this.last=e,e.next=null}else this.first=e,this.last=e,e.next=null,e.prev=null;this.length++,this.showDebug&&this.dump("after add")},this.has=function(t){return!!this.objToNodeMap[t.uniqueId]},this.moveUp=function(t){this.dump("before move up");var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.prev){var i=e.prev,n=i.prev;e==this.last&&(this.last=i);var s=e.next;n&&(n.next=e),e.next=i,e.prev=i.prev,i.next=s,i.prev=e,this.first==i&&(this.first=e)}},this.moveDown=function(t){var e=this.getNode(t);if(!e)throw"Oops, trying to move an object that isn't in the list";if(null!=e.next){var i=e.next;this.moveUp(i.obj),this.last==i&&(this.last=e)}},this.sort=function(t){for(var e,i,n=[],s=this.first;s;)n.push(s.object()),s=s.next();for(this.clear(),n.sort(t),i=n.length,e=0;i>e;e++)this.add(n[e])},this.remove=function(t){var e=this.getNode(t);return null==e||1==e.free?!1:(null!=e.prev&&(e.prev.next=e.next),null!=e.next&&(e.next.prev=e.prev),null==e.prev&&(this.first=e.next),null==e.next&&(this.last=e.prev),e.free=!0,e.prev=null,e.next=null,this.length--,!0)},this.shift=function(){var t=this.first;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.first=t.next,t.next||(this.last=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.pop=function(){var t=this.last;return 0===this.length?null:(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.last=t.prev,t.prev||(this.first=null),t.free=!0,t.prev=null,t.next=null,this.length--,t.obj)},this.clear=function(){for(var t=this.first;t;)t.free=!0,t=t.next;this.first=null,this.length=0},this.dispose=function(){for(var t=this.first;t;)t.obj=null,t=t.next;this.first=null,this.objToNodeMap=null},this.dump=function(t){console.log("===================="+t+"=====================");for(var e=this.first;null!=e;)console.log("{"+e.obj.toString()+"} previous="+(e.prev?e.prev.obj:"NULL")),e=e.next();console.log("==================================="),console.log("Last: {"+(this.last?this.last.obj:"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}};return window.LinkedList=e,e}),define("Container",["require"],function(){var t=function(){this.uniqueId=Math.random().toString(36).slice(2)+Date.now(),this.children=new LinkedList,this.visible=!0,this.position=new Vec2,this.angle=0,this.alpha=1,this.parent=null,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.regX=0,this.regY=0,this.compositeOperation=null,this.sourceRect=null,this._matrix=new Matrix2,this._scratchPoint=new Point};return t.prototype={draw:function(t){var e,i,n,s=(this.sourceRect,this);for(n=s._matrix.identity(),n.appendTransform(s.position.x,s.position.y,s.scaleX,s.scaleY,s.angle,s.skewX,s.skewY,s.regX,s.regY),t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),t.globalAlpha*=s.alpha,s.compositeOperation&&(t.globalCompositeOperation=s.compositeOperation),e=this.children.first;e;)i=e.obj,i.visible&&(t.save(),i.draw(t),t.restore()),e=e.next},addChild:function(t){var e,i=arguments.length;if(i>1){for(e=0;i>e;e++)this.addChild(arguments[e]);return arguments[i-1]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.add(t),t},removeChild:function(t){return this.children.remove(t)},removeAllChildren:function(){this.children.clear()},sortChildren:function(t){this.children.sort(t)},contains:function(t){for(;t;){if(t===this)return!0;t=t.parent}return!1},toString:function(){return"[Container (name="+this.name+")]"},getStage:function(){for(var t=this;t.parent;)t=t.parent;return t},localToGlobal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},globalToLocal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.invert(),i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},localToLocal:function(t,e,i){var n=this.localToGlobal(t,e);return i.globalToLocal(n.x,n.y)},setTransform:function(t,e,i,n,s,r,o,l,a){return this.position.x=t||0,this.position.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==n?1:n,this.angle=s||0,this.skewX=r||0,this.skewY=o||0,this.regX=l||0,this.regY=a||0,this},getMatrix:function(t){var e=this;return(t?t.identity():new Matrix2).appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY)},getConcatenatedMatrix:function(t){t?t.identity():t=new Matrix2;for(var e=this;null!=e;)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY),e=e.parent;return t}},t}),define("Sprite",["require"],function(){var t=function(t){this.uniqueId=Math.random().toString(36).slice(2)+Date.now(),this.image=t,this.visible=!0,this.position=new Vec2,this.angle=0,this.alpha=1,this.parent=null,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.regX=0,this.regY=0,this.compositeOperation=null,this.sourceRect=null,this._matrix=new Matrix2,this._scratchPoint=new Point};return t.prototype={isVisible:function(){return this.visible&&this.alpha>0&&this.scaleX&&this.scaleY},draw:function(t){var e,i=this.sourceRect,n=this;e=n._matrix.identity(),e.appendTransform(n.position.x,n.position.y,n.scaleX,n.scaleY,n.angle,n.skewX,n.skewY,n.regX,n.regY),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha*=n.alpha,n.compositeOperation&&(t.globalCompositeOperation=n.compositeOperation),i?t.drawImage(this.image,i.x,i.y,i.width,i.height,0,0,i.width,i.height):t.drawImage(this.image,0,0)},getStage:function(){for(var t=this;t.parent;)t=t.parent;return t},localToGlobal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},globalToLocal:function(t,e){var i=this.getConcatenatedMatrix(this._matrix);return null==i?null:(i.invert(),i.append(1,0,0,1,t,e),this._scratchPoint.reset(i.tx,i.ty))},localToLocal:function(t,e,i){var n=this.localToGlobal(t,e);return i.globalToLocal(n.x,n.y)},setTransform:function(t,e,i,n,s,r,o,l,a){return this.position.x=t||0,this.position.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==n?1:n,this.angle=s||0,this.skewX=r||0,this.skewY=o||0,this.regX=l||0,this.regY=a||0,this},getMatrix:function(t){var e=this;return(t?t.identity():new Matrix2).appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY)},getConcatenatedMatrix:function(t){t?t.identity():t=new Matrix2;for(var e=this;null!=e;)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.angle,e.skewX,e.skewY,e.regX,e.regY),e=e.parent;return t},toString:function(){return"[Sprite (name="+this.name+")]"}},t})}();